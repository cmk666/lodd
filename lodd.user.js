// ==UserScript==
// @name         Luogu Original Difficulty Display
// @version      4.3
// @description  Luogu original difficulty display
// @author       cmk666
// @match        https://www.luogu.com.cn/*
// @connect      codeforces.com
// @connect      kenkoooo.com
// @icon         https://www.google.com/s2/favicons?sz=64&domain=luogu.com.cn
// @grant        GM_xmlhttpRequest
// ==/UserScript==
(()=>{"use strict";const t="#app>div.main-container>main>div>section.side>div:nth-child(1)>div>div:nth-child(4)>span:nth-child(1)>span",l="#app>div.main-container>main>div>section.side>div:nth-child(1)>div>div:nth-child(5)>span:nth-child(1)>span",n="原始难度",r="获取中",a="暂无难度",i="获取失败";var c,s,f;const h=()=>{void 0!==c&&void 0!==s&&void 0!==f&&(f.innerText=c,""!==s)&&f.classList.add(s)},u=o=>o<1200?"lodd-cf-gray":o<1400?"lodd-cf-green":o<1600?"lodd-cf-cyan":o<1900?"lodd-cf-blue":o<2100?"lodd-cf-purple":o<2400?"lodd-cf-orange":o<3e3?"lodd-cf-red":"lodd-cf-blackred",g=o=>o<400?"lodd-at-gray":o<800?"lodd-at-brown":o<1200?"lodd-at-green":o<1600?"lodd-at-aqua":o<2e3?"lodd-at-blue":o<2400?"lodd-at-yellow":o<2800?"lodd-at-orange":"lodd-at-red",p=(o,e)=>{e.parentNode.lastChild==e?e.parentNode.appendChild(o):e.parentNode.insertBefore(o,e.nextSibling)},b=o=>{return!!/^\/problem\/\w+/.test(o)&&(o=o.substr(9),/^CF\d+[A-Z]\d*(#\w+)?$/.test(o)||/^AT_\w+(#\w+)?$/.test(o))},v=o=>{if(c=s=void 0,b(o)){var e,o=o.substr(9);if(null!==(e=/^CF(\d+)([A-Z]\d*)(#\w+)?$/.exec(o))){const d=e[1],t=e[2];GM_xmlhttpRequest({method:"GET",url:"https://codeforces.com/api/contest.standings?from=1&count=1&contestId="+d,onload:o=>{try{var e=JSON.parse(o.responseText);if("OK"!==e.status);else for(var d of e.result.problems)if(d.index===t)return s=void 0===d.rating?(c=a,""):(c=d.rating,u(d.rating)),void h();c=i,s="",h()}catch{c=i,s="",h()}},onerror:()=>{c=i,s="",h()}})}else if(null!==(e=/^AT_(\w+)(#\w+)?$/.exec(o))){const l=e[1];GM_xmlhttpRequest({method:"GET",url:"https://kenkoooo.com/atcoder/resources/problem-models.json",onload:o=>{try{var e=JSON.parse(o.responseText)[l];void 0!==e?(s=void 0===e.difficulty?(c=a,""):(c=e.difficulty,g(e.difficulty)),h()):(c=i,s="",h())}catch{c=i,s="",h()}},onerror:()=>{c=i,s="",h()}})}}},d=o=>{var e=document.createElement("style"),e=(e.innerText=".lodd-cf-gray{font-weight:bold;color:gray;}.lodd-cf-green{font-weight:bold;color:green;}.lodd-cf-cyan{font-weight:bold;color:#03a89e;}.lodd-cf-blue{font-weight:bold;color:blue;}.lodd-cf-purple{font-weight:bold;color:#a0a;}.lodd-cf-orange{font-weight:bold;color:#ff8c00;}.lodd-cf-red,.lodd-cf-blackred{font-weight:bold;color:red;}.lodd-cf-blackred:first-letter{font-weight:bold;color:black;}.lodd-at-gray{font-weight:bold;color:gray;}.lodd-at-brown{font-weight:bold;color:#804000;}.lodd-at-green{font-weight:bold;color:green;}.lodd-at-aqua{font-weight:bold;color:#00c0c0;}.lodd-at-blue{font-weight:bold;color:blue;}.lodd-at-yellow{font-weight:bold;color:#c0c000;}.lodd-at-orange{font-weight:bold;color:#ff8000;}.lodd-at-red{font-weight:bold;color:red;}",document.head.appendChild(e),v(o),o);if(f=void 0,b(e)){const d=setInterval(()=>{var o,e;void 0!==f||null!==(o=document.querySelector(l))&&o.innerText===n||null!=(o=document.querySelector(t))&&((e=o.parentNode.parentNode.cloneNode(!0)).children[0].children[0].innerHTML=n,(f=e.children[1]).innerHTML=r,p(e,o.parentNode.parentNode),h(),clearInterval(d))},100)}};let w=unsafeWindow.console.info;Object.defineProperty(unsafeWindow.console,"info",{set:o=>{console.warn("Some script is trying to modify `unsafeWindow.console.info`. Maybe SB exlg?"),w=o},get:()=>(...o)=>{var e;"[@lfe/loader]"===o[0]&&"Navigated"===o[1]&&(null!==(e=document.querySelector(l))&&e.innerText===n&&(e=e.parentNode.parentNode).parentNode.removeChild(e),d(o[2])),w(...o)}}),addEventListener("ononline",v),d(location.pathname)})();